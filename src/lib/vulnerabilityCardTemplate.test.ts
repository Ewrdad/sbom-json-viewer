import { describe, it, expect } from 'vitest';
import { getVulnerabilityCardHtml } from './vulnerabilityCardTemplate';

describe('vulnerabilityCardTemplate', () => {
  const mockVulnerability = {
    id: 'CVE-2021-23337',
    severity: 'High',
    description: 'Test Description',
    detail: 'Detailed Analysis',
    cwes: [79, 89],
    recommendation: 'Fix it',
    workaround: 'Do this',
    affectedCount: 1,
    affectedComponentRefs: ['pkg:npm/lodash@4.17.20'],
    affects: [
      {
        ref: 'pkg:npm/lodash@4.17.20',
        versions: [{ status: 'affected' }]
      }
    ],
    source: { name: 'NVD', url: 'https://nvd.nist.gov' },
    created: '2021-01-01T00:00:00Z',
    published: '2021-01-02T00:00:00Z',
    updated: '2021-01-03T00:00:00Z'
  };

  const mockComponents = [
    {
      name: 'lodash',
      ref: 'pkg:npm/lodash@4.17.20',
      version: '4.17.20'
    }
  ];

  it('should generate HTML containing the vulnerability ID', () => {
    const html = getVulnerabilityCardHtml(mockVulnerability, mockComponents);
    expect(html).toContain('CVE-2021-23337');
  });

  it('should generate HTML containing the severity', () => {
    const html = getVulnerabilityCardHtml(mockVulnerability, mockComponents);
    expect(html).toContain('High');
  });

  it('should generate HTML containing the description', () => {
    const html = getVulnerabilityCardHtml(mockVulnerability, mockComponents);
    expect(html).toContain('Test Description');
  });

  it('should generate HTML containing affected components', () => {
    const html = getVulnerabilityCardHtml(mockVulnerability, mockComponents);
    expect(html).toContain('lodash');
    expect(html).toContain('pkg:npm/lodash@4.17.20');
  });

  it('should handle missing fields gracefully', () => {
    const minimalVuln = {
      id: 'VULN-1',
      severity: 'Low',
      affectedCount: 0
    };
    const html = getVulnerabilityCardHtml(minimalVuln, []);
    expect(html).toContain('VULN-1');
    expect(html).toContain('Low');
  });
});

import { render, screen } from '@testing-library/react';
import { describe, it, expect } from 'vitest';
import { VulnerabilityLink } from './VulnerabilityLink';
import '@testing-library/jest-dom';

describe('VulnerabilityLink', () => {
  it('should render CWE link correctly', () => {
    render(<VulnerabilityLink id="CWE-79" />);
    const link = screen.getByRole('link', { name: /CWE-79/i });
    expect(link).toHaveAttribute('href', 'https://cwe.mitre.org/data/definitions/79.html');
    expect(link).toHaveAttribute('target', '_blank');
  });

  it('should render CVE link correctly', () => {
    render(<VulnerabilityLink id="CVE-2023-1234" />);
    const link = screen.getByRole('link', { name: /CVE-2023-1234/i });
    expect(link).toHaveAttribute('href', 'https://nvd.nist.gov/vuln/detail/CVE-2023-1234');
  });

  it('should render GHSA link correctly', () => {
    render(<VulnerabilityLink id="GHSA-xxxx-yyyy-zzzz" />);
    const link = screen.getByRole('link', { name: /GHSA-xxxx-yyyy-zzzz/i });
    expect(link).toHaveAttribute('href', 'https://github.com/advisories/GHSA-XXXX-YYYY-ZZZZ');
  });

  it('should render just text for unknown format', () => {
    render(<VulnerabilityLink id="UNKNOWN-123" />);
    expect(screen.queryByRole('link')).not.toBeInTheDocument();
    expect(screen.getByText('UNKNOWN-123')).toBeInTheDocument();
  });

  it('should handle mixed case and whitespace', () => {
    render(<VulnerabilityLink id="  cwe-79  " />);
    const link = screen.getByRole('link', { name: /cwe-79/i });
    expect(link).toHaveAttribute('href', 'https://cwe.mitre.org/data/definitions/79.html');
  });

  it('should show icon when requested', () => {
    render(<VulnerabilityLink id="CWE-79" showIcon={true} />);
    // ExternalLink icon is usually rendered as an svg or has some class/testid
    // For now we check if the link contains the text
    expect(screen.getByRole('link')).toBeInTheDocument();
  });
});
